<!doctype html>
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title></title>
  <meta name="description" content="">
  <meta name="author" content="">

  <meta name="viewport" content="width=device-width,initial-scale=1">

  <!-- CSS concatenated and minified via ant build script-->
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/solarized_light.css">

  <style type="text/css">
/*    html {background-color: #933; }*/
    header{ position:relative; height: 180px; }
    h1{
      font-family: 'History-One', cursive; 
      font-size:72px; 
      color:#399; 
      font-weight:normal; 
      position:absolute;
      top:0; left:0;
      letter-spacing:.25em;
    }
    h1.one { font-family: 'History-One' ; }
    h1.seventeen{ font-family: 'History-Seventeen' ; }
    h1.thirteen { font-family: 'History-Thirteen' ; }
    h1.eleven { font-family: 'History-Eleven' ; }
    h1.six { font-family: 'History-Six' ; }

    .bluegreen { color: #399; }
    .orange { color: orange; }
    .pink { color:pink; }
    .green { color:green; }
    .blue { color:blue; }

    h2, h3 { font-family: "History-Four"; font-weight:normal; letter-spacing: .25em; }

    #container{ width:800px; padding:20px; background-color: }
    .example{ width: 600px; margin-top:4em; border-bottom:1px solid #ccc; position:relative; }
    .demo { position:absolute; right:-300px; top: 0; width:275px; }
  </style>
  <!-- end CSS-->

  <script src="js/libs/modernizr-2.0.6.min.js"></script>
  <!-- <link href='http://fonts.googleapis.com/css?family=Monoton' rel='stylesheet' type='text/css'> -->
</head>

<body>

  <div id="container">
    <header>
      <h1 data-overlay="feet,blerg">meatglue</h1>
    </header>
    <div id="main" role="main" class="">
      <div class="intro">
        <p>Meatglue is a jQuery+Backbone+jQueryUI library which simplifies the process of creating reactive bindings on your webpages.
        <p>Modeled off Bret Victor's tangle and TangleKit (who, btw, hat tip), meatglue is designed to be used in a similar fashion, but on sites where backbone and jquery ui are already present. Meatglue is not tangle, though.
        <p>A better way of thinking about it is a collection of related views which can be rapidly dropped into a page. The emphasis here is rapid development. I like backbone, but it's a bit time consuming to set up a json object to get a backbone test going.
        <p>This is like diet-backbone, you get some pre-built views and some pre-made bindings. You can specify validation functions (or not) and you can also set up mappings/bindings from variables onto other variables.
      </div>

      <h2>Getting Started</h2>
      <p>The general pattern for using meatglue is to write a meatglue script and then include meatglue variables in your html. Wrap the whole section in some class and then call <code>$.fn.meatglue($('.someSelector'))</code>

      <h2>Variable Types</h2>

      <div class="meatglue example">
        <h3>VarView</h3>
        <p>The simplest meatglue variable is the VarView, you can specify it by giving a <code>span</code> element <code>data-name</code> attribute. The <code>span</code> will be populated with the corresponding variable set in defaults</p>

        <div class="demo">
          <script type="text/meatglue">
            defaults = { pinky: "Gee, Brain, what do you want to do tonight?" };
          </script>
          
          <p>Here is a variable: <span data-name="pinky"></span></p>
        </div>

        <div class="codesnippets"></div>
      </div>

      <div class="meatglue example">
        <h3>FreeInput</h3>
        <p>The FreeInput var allows you to store the contents of an <code>input</code> element into a meatglue variable. There is no sort of validation by default, although you can use the <code>update</code> method to force certain values.</p>

        <div class="demo">
          <script type="text/meatglue">
            defaults = { freeinput: "type something here" };
          </script>
          
          <p>This is a free input: <span data-name="freeinput" data-type="input"></span>.</p>
          <p>Its value is mirrored here: <span data-name="freeinput"></span> </p>
        </div>
      </div>

      <div class="meatglue example">
        <h3>EditableVar</h3>
        <p>The <code>EditableVar</code> allows you to have something similar to the InputVar, but instead, it is rendered as plain text. When you click on it, the value becomes editable. When you tab out or blur the input, it reverts to plain text again.</p>
        <p>This element <em>does</em> do validation on its content, in particular it requires numeric input or it will mark itself as invalid until a number appears in the textbox

        <div class="demo">
          <script type="text/meatglue">
            defaults = { clicky: 23 };
            update = function(){
              var clicky = this.get("clicky");
              this.set({"doubleclick": clicky * 2});
            }
          </script>

          <p>This is an editable variable: <span data-name="clicky" data-type="editable"></span>.</p>
          <p>When you change it, its value is doubled here: <span data-name="doubleclick"></span> </p>
        </div>

      </div>

      <div class="meatglue example">
        <h3>SlidableVar</h3>
        <p>The <code>SlidableVar</code>'s interaction is lifted from TangleKit. It provides a variable whose value can be dragged, left or right, up to some min/max value you can set.</p>

        <div class="demo">
          <script type="text/meatglue">
            defaults = { 
              slider: 23,
              mini: 1
             };
            update = function(){
              var slider = this.get("slider");
              this.set({"miniburger": Math.pow(slider, 2)});
            }
          </script>
          
          <p>This is an slidable variable that defaults to min/max of [-100, 100]: <span data-name="slider" data-type="slidable"></span>. When you drag it, its value is squared here: <span data-name="miniburger"></span> </p>
          
          <p>This var has a restricted range of [1, 19]. <span data-name="mini" data-type="slidable" data-min="1" data-max="19"></span>. Nothing is currently listening to it.</p>
        </div>

      </div>

      <div class="meatglue example">
        <h3>Draggables and Droppables</h3>
        <p>
      </div>


      <div class="meatglue">
        <p> In general, the conversion between Celsius and Fahrenheit is governed by <i>F = C * 9/5 + 32</i>. So, for example: <span data-name="CELCIUS"></span>°C = <span data-name="FARENHEIT"></span>°F </p>
        <p>What temperature, in degrees celcius, would we need to get to <span data-name="FEXPECTED"></span>°F? Change this value here: <span data-name="CELCIUS" data-type="editable"></span>°C

        <p>Great! <span data-name="CELCIUS"></span>°C is the right value.</p>
        <p>let's see what happens here:<span data-name="blerg" data-type="slidable"></span> ==> <span data-name="foo"></span>

        <p>Fun with ratios! A : B :: C : D
        <p>Here are some variables to drag around: 
          <span data-name="A" data-type="draggable"></span>
          <span data-name="B" data-type="draggable"></span>
          <span data-name="C" data-type="draggable"></span>
          <span data-name="D" data-type="draggable"></span>
        </p>
        <p>Here are some targets:
          <span data-name="target1" data-type="droppable"></span>:
          <span data-name="target2" data-type="droppable"></span>::
          <span data-name="target3" data-type="droppable"></span>:
          <span data-name="target4" data-type="droppable"></span>

      
      <div data-section="ratio-success">
        <p> Booyeah!
      </div>

	    <script type="text/meatglue">
	        // populate some defaults
	        defaults = {
	          "freeinput" : "hee hee",
	          "CELCIUS" : 23,
	          "FEXPECTED" : 149,
	          "blerg" : 12,
	          "foo" : 14,
	          "A":3,
	          "B":4,
	          "C":12,
	          "D":16
	        }

	        update = function(){
	          var celcius = this.get("CELCIUS");
	          var fExpected = this.get("FEXPECTED");
	          var blerg = this.get("blerg");

	          this.set({"FARENHEIT": (celcius * 9 / 5 ) + 32 });
	          if(this.get("FARENHEIT") == fExpected){
	          }
	          this.set({"foo": blerg * 3});
	          var t1 = this.getget("target1");
	          var t2 = this.getget("target2");
	          var t3 = this.getget("target3");
	          var t4 = this.getget("target4");
	          var a = this.get("A");
	          var b = this.get("B")
	          if(t1/t2 === t3/t4 && t1/t2 === a/b){
	            this.reveal("ratio-success")
                $("[data-section='ratio-success']").html("<p>Ratio Success!</p>")
	          }else{
	          	$("[data-section='ratio-success']").html("<p>Make the ratio work!")
	          }
	        }

	        init = function(){
	          this.update();
	          this.reveal("ratios");
	        }

	    </script>
      </div>

    </div>

    

  </div> <!--! end of #container -->


  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.js"></script>
  <script>window.jQuery || document.write('<script src="js/libs/jquery-1.7.1.js"><\/script>')</script>
  <script src="js/libs/underscore.js"></script>
  <script src="js/libs/backbone.js"></script>
  <script src="js/libs/jquery-ui-1.8.16.custom.min.js"></script>
  <script src="js/libs/jquery.mobile.vmouse.js"></script>

  <script src="http://yandex.st/highlightjs/6.1/highlight.min.js"></script>

  <!-- scripts concatenated and minified via ant build script-->
  <script defer src="js/plugins.js"></script>

  <!-- put your new backbone creation here -->
  <script src="js/meatglue.js"></script>
	<script type="text/javascript" charset="utf-8">  

  // dedent a block of text so that everything starts at least 0 spaces from the
  // start of the line (but retain actual indenting inside the block)
  var dedent = function( somecode ){
    var pieced = somecode.split("\n");
    var testre = /^(\s*)/gm;

    var spacey = /^(\s*)\S*/;
    var defaultindent = _(pieced)
      .map( function(line){ return spacey.exec(line); } )
      .filter(function(match){ return match[0].length !== match[1].length; })
      .map(function(match){ return match[1].length })
    var minIndent = _(defaultindent).min()
    cutitout = new RegExp("^\\s{"+minIndent+"}","gm")
    somecode = $.trim(somecode).replace(cutitout, "")
    return somecode;
  }

  $(document).ready(function(){
	// for each meatglue block, gather the documentation and append it to 
	// the codesnippets div
    $(".meatglue").each(function(i,e){
      var demoblock = $(e);

      var codeholder = $("<div>",{class:"codesnippets"});

      // grab code in each block, dedent it, and add to the pre
      demoblock.find(".demo").each(function( idx, elt ){
        var somecode = dedent( $(elt).html() );
        var snippet = $("<pre>").append($("<code>").text( somecode ))
        codeholder.append(snippet)
      })
      demoblock.append(codeholder);
    })

    // apply syntax highlighting ( will probably switch this later, but i'm a sucker
    // for solarized )
    $(".codesnippets pre code").each(function(i,e){ hljs.highlightBlock(e, '  '); })

    // actually eval meatglue scripts for each given meatglue block
    $.fn.meatglueLoad( $(".meatglue") )

    // prettify the header
    $("h1").each(function(i,e){
      // var otherFonts = $(e).data("overlay").split(",");
      var otherFonts =  _(
		  _.shuffle(["one", "seventeen", "thirteen", "eleven", "six"]))
		.first(3); 
      var colours = _.first(
        _(["bluegreen", "orange", "pink", "green", "blue"]).shuffle(),
        3)
      _(otherFonts).each(function(elt, idx){
        var dup = $(e).clone().addClass( elt+" "+colours[idx] );
        $("header").append(dup)
      });
    })

  })
  </script>
  <!-- end scripts-->

  <!--[if lt IE 7 ]>
    <script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script>
    <script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script>
  <![endif]-->

</body>
</html>
